<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>贪吃蛇</title>
	<style>
		body { font-family: Arial, sans-serif; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; background-image:url('snake.png'); background-size:cover; background-position:center; position:relative; }
		.navbar { background:rgba(51,51,51,0.7); overflow:hidden; width:100%; transition:top .3s ease-in-out; position:fixed; top:-60px; z-index:1000; }
		.navbar.show { top:0; }
		.navbar a { float:left; display:block; color:#fff; text-align:center; padding:14px 20px; text-decoration:none; }
		.navbar a:hover { background:#ddd; color:#000; }
		.container { flex:1; display:flex; gap:20px; align-items:stretch; justify-content:center; padding:100px 20px 70px; box-sizing:border-box; }
		.panel { background:rgba(0,0,0,0.5); border-radius:10px; color:#fff; padding:16px; backdrop-filter:blur(2px); }
		.sidebar { width:260px; display:flex; flex-direction:column; gap:12px; }
		.title { margin:0 0 8px; font-size:24px; }
		.row { display:flex; gap:10px; flex-wrap:wrap; }
		.button { cursor:pointer; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.25); color:#fff; padding:10px 14px; border-radius:8px; transition:.2s; }
		.button:hover { background:rgba(255,255,255,0.2); transform:translateY(-1px); }
		.kbd { display:inline-block; padding:2px 6px; background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.25); border-radius:4px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-size:12px; }
		canvas { background:rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.2); border-radius:10px; }
		footer { background:rgba(51,51,51,0.7); color:#fff; text-align:center; padding:10px 0; position:fixed; bottom:0; width:100%; height:50px; z-index:1000; }
		.gameover { position:absolute; inset:0; display:none; align-items:center; justify-content:center; color:#fff; font-size:36px; background:rgba(0,0,0,0.45); border-radius:10px; }
	</style>
</head>
<body>

<div class="navbar" id="navbar">
	<a href="index.html">首页</a>
	<a href="game.html">返回游戏中心</a>
</div>

<div class="container">
	<div class="panel sidebar">
		<h2 class="title">贪吃蛇</h2>
		<div>按 <span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span> 或方向键移动，吃到食物加分变长</div>
		<div class="row">
			<button id="startBtn" class="button">开始游戏</button>
			<button id="pauseBtn" class="button">暂停</button>
			<button id="resetBtn" class="button">重开</button>
		</div>
		<div>分数：<span id="score">0</span></div>
		<div>长度：<span id="length">1</span></div>
		<!-- 移动端方向键 -->
		<div id="mobileControls" style="display:none; margin-top:8px;">
			<div style="display:grid; grid-template-columns:repeat(3,56px); grid-auto-rows:56px; gap:8px; justify-items:center; align-items:center;">
				<div></div>
				<button id="btnUp" class="button" style="width:56px; height:56px;">↑</button>
				<div></div>
				<button id="btnLeft" class="button" style="width:56px; height:56px;">←</button>
				<div></div>
				<button id="btnRight" class="button" style="width:56px; height:56px;">→</button>
				<div></div>
				<button id="btnDown" class="button" style="width:56px; height:56px;">↓</button>
				<div></div>
			</div>
		</div>
	</div>
	<div class="panel" style="position:relative;">
		<canvas id="snake" width="600" height="600"></canvas>
		<div id="gameOverLayer" class="gameover">GAME OVER</div>
	</div>
</div>

<footer>
	<p>&copy; 2025 贪吃蛇</p>
</footer>

<script>
	// 顶部导航显隐
	document.addEventListener('mousemove', function(e){
		document.getElementById('navbar').classList.toggle('show', e.clientY < 60);
	});

	var canvas = document.getElementById('snake');
	var ctx = canvas.getContext('2d');
	var CELL = 20; // 30x30 网格
	var COLS = canvas.width / CELL;
	var ROWS = canvas.height / CELL;
	var snake = [{ x: Math.floor(COLS/2), y: Math.floor(ROWS/2) }];
	var dir = { x: 1, y: 0 };
	var pendingDir = dir;
	var food = spawnFood();
	var running = false;
	var isGameOver = false;
	var score = 0;
	var tickInterval = 120; // 毫秒
	var lastTick = 0;

	function spawnFood(){
		var pos;
		while (true) {
			pos = { x: Math.floor(Math.random() * COLS), y: Math.floor(Math.random() * ROWS) };
			var conflict = snake.some(function(s){ return s.x === pos.x && s.y === pos.y; });
			if (!conflict) return pos;
		}
	}

	function drawCell(gx, gy, color){
		ctx.fillStyle = color;
		ctx.fillRect(gx * CELL, gy * CELL, CELL, CELL);
		ctx.strokeStyle = 'rgba(255,255,255,0.1)';
		ctx.strokeRect(gx * CELL + 0.5, gy * CELL + 0.5, CELL - 1, CELL - 1);
	}

	function draw(){
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		// 背景棋盘
		ctx.fillStyle = '#30363d';
		for (var x = 0; x < COLS; x++) {
			for (var y = 0; y < ROWS; y++) {
				ctx.fillRect(x * CELL + 2, y * CELL + 2, CELL - 4, CELL - 4);
			}
		}
		// 食物
		drawCell(food.x, food.y, '#ffd700');
		// 蛇
		for (var i = 0; i < snake.length; i++) {
			drawCell(snake[i].x, snake[i].y, i === 0 ? '#56d364' : '#79c0ff');
		}
	}

	function update(time){
		if (!running) return;
		if (time - lastTick < tickInterval) { requestAnimationFrame(update); return; }
		lastTick = time;
		// 更新方向（禁止直接反向）
		if (Math.abs(pendingDir.x) !== Math.abs(dir.x) || Math.abs(pendingDir.y) !== Math.abs(dir.y)) {
			dir = pendingDir;
		}
		// 移动
		var head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
		// 撞墙
		if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) { return gameOver(); }
		// 撞自己
		for (var i = 0; i < snake.length; i++) { if (snake[i].x === head.x && snake[i].y === head.y) { return gameOver(); } }
		snake.unshift(head);
		// 吃食物
		if (head.x === food.x && head.y === food.y) {
			score += 10;
			document.getElementById('score').textContent = String(score);
			document.getElementById('length').textContent = String(snake.length);
			food = spawnFood();
		} else {
			snake.pop();
		}
		draw();
		requestAnimationFrame(update);
	}

	function startGame(){
		if (running) return;
		if (isGameOver) resetGame();
		running = true;
		requestAnimationFrame(update);
	}
	function pauseGame(){ running = false; }
	function gameOver(){ running = false; isGameOver = true; document.getElementById('gameOverLayer').style.display = 'flex'; }
	function resetGame(){
		running = false; isGameOver = false;
		snake = [{ x: Math.floor(COLS/2), y: Math.floor(ROWS/2) }];
		dir = { x: 1, y: 0 }; pendingDir = dir; food = spawnFood();
		score = 0; document.getElementById('score').textContent = '0'; document.getElementById('length').textContent = '1';
		document.getElementById('gameOverLayer').style.display = 'none';
		draw();
	}

	// 控制
	document.addEventListener('keydown', function(e){
		if (!running) return;
		if (e.code === 'ArrowUp' || e.code === 'KeyW') pendingDir = { x: 0, y: -1 };
		else if (e.code === 'ArrowDown' || e.code === 'KeyS') pendingDir = { x: 0, y: 1 };
		else if (e.code === 'ArrowLeft' || e.code === 'KeyA') pendingDir = { x: -1, y: 0 };
		else if (e.code === 'ArrowRight' || e.code === 'KeyD') pendingDir = { x: 1, y: 0 };
	});

	// 按钮
	var startBtn = document.getElementById('startBtn');
	var pauseBtn = document.getElementById('pauseBtn');
	var resetBtn = document.getElementById('resetBtn');
	startBtn.addEventListener('click', startGame);
	pauseBtn.addEventListener('click', pauseGame);
	resetBtn.addEventListener('click', resetGame);

	// 初始化
	draw();

	// 移动端适配：显示方向键、缩放画布
	(function(){
		var mobile = window.innerWidth <= 900;
		var mobileControls = document.getElementById('mobileControls');
		if (mobileControls) mobileControls.style.display = mobile ? 'block' : 'none';
		function resize(){
			if (window.innerWidth <= 900) {
				var maxW = Math.min(window.innerWidth - 24, 600);
				var r = maxW / canvas.width;
				canvas.style.width = maxW + 'px';
				canvas.style.height = (canvas.height * r) + 'px';
			} else {
				canvas.style.width = '';
				canvas.style.height = '';
			}
		}
		window.addEventListener('resize', resize);
		resize();
		// 绑定虚拟方向键
		function setDir(nx, ny){
			// 禁止直接反向，与键盘逻辑一致
			if (Math.abs(nx) !== Math.abs(dir.x) || Math.abs(ny) !== Math.abs(dir.y)) {
				pendingDir = { x: nx, y: ny };
			}
		}
		function bind(id, nx, ny){
			var el = document.getElementById(id);
			if (!el) return;
			el.addEventListener('click', function(){ setDir(nx, ny); });
			el.addEventListener('touchstart', function(e){ setDir(nx, ny); e.preventDefault(); }, { passive:false });
		}
		bind('btnUp', 0, -1); bind('btnDown', 0, 1); bind('btnLeft', -1, 0); bind('btnRight', 1, 0);
	})();

</script>

</body>
</html>


